<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-base/Netty/问题总结" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">问题总结 | 程序员xilio</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://xilio-doc.github.io/xilio-doc/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://xilio-doc.github.io/xilio-doc/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://xilio-doc.github.io/xilio-doc/en/docs/base/Netty/问题总结"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="问题总结 | 程序员xilio"><meta data-rh="true" name="description" content="Netty 基础相关问题"><meta data-rh="true" property="og:description" content="Netty 基础相关问题"><link data-rh="true" rel="icon" href="/xilio-doc/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://xilio-doc.github.io/xilio-doc/en/docs/base/Netty/问题总结"><link data-rh="true" rel="alternate" href="https://xilio-doc.github.io/xilio-doc/en/docs/base/Netty/问题总结" hreflang="en"><link data-rh="true" rel="alternate" href="https://xilio-doc.github.io/xilio-doc/docs/base/Netty/问题总结" hreflang="zh"><link data-rh="true" rel="alternate" href="https://xilio-doc.github.io/xilio-doc/docs/base/Netty/问题总结" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/xilio-doc/en/blog/rss.xml" title="程序员xilio RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/xilio-doc/en/blog/atom.xml" title="程序员xilio Atom Feed">




<script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?" async data-ad-client="ca-pub-5856655690528931"></script><link rel="stylesheet" href="/xilio-doc/en/assets/css/styles.b5a9fb8f.css">
<script src="/xilio-doc/en/assets/js/runtime~main.e537a667.js" defer="defer"></script>
<script src="/xilio-doc/en/assets/js/main.84c7c5ef.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/xilio-doc/en/img/logo4.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_krfC" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/xilio-doc/en/"><div class="navbar__logo"><img src="/xilio-doc/en/img/logo4.png" alt="xilio Logo" class="themedComponent_DBJS themedComponent--light_srcf"><img src="/xilio-doc/en/img/logo4.png" alt="xilio Logo" class="themedComponent_DBJS themedComponent--dark_BwVf"></div><b class="navbar__title text--truncate">程序员</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/xilio-doc/en/docs/base/Java/jvm/内存泄漏">青铜段位</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/xilio-doc/en/blog">博客</a><a href="https://github.com/xilio-dev" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QBFE"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://gitee.com/xilio" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_QBFE"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_aqmj colorModeToggle_AEMF"><button class="clean-btn toggleButton_e_pL toggleButtonDisabled_DopM" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_kDty"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_JuIf"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_ENFa"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z7Es"><div class="docsWrapper_eKlp"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_KpH3" type="button"></button><div class="docRoot_zzrW"><aside class="theme-doc-sidebar-container docSidebarContainer_LcIi"><div class="sidebarViewport_FBf4"><div class="sidebar_fj3_"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_KKwp"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/xilio-doc/en/docs/base/Java/jvm/内存泄漏">Java</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/xilio-doc/en/docs/base/Netty/ByteBuf">Netty</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xilio-doc/en/docs/base/Netty/ByteBuf">ByteBuf</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xilio-doc/en/docs/base/Netty/Protobuf">Protobuf</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xilio-doc/en/docs/base/Netty/入门案例">入门案例</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xilio-doc/en/docs/base/Netty/基础知识">基础知识</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xilio-doc/en/docs/base/Netty/常见的坑">常见的坑</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xilio-doc/en/docs/base/Netty/应用场景">应用场景</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xilio-doc/en/docs/base/Netty/网络基础">网络基础</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/xilio-doc/en/docs/base/Netty/问题总结">问题总结</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/xilio-doc/en/docs/base/Netty/高级">高级</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/xilio-doc/en/docs/base/Redis/介绍">Redis</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/xilio-doc/en/docs/base/Zookeeper/介绍">Zookeeper</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/xilio-doc/en/docs/base/intro">介绍</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/xilio-doc/en/docs/base/其他/Linux/Shell脚本用法">其他</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_ilkh"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_gAo8"><div class="docItemContainer_AOme"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Ry_8" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/xilio-doc/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_u7p0"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Netty</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">问题总结</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_D3ep theme-doc-toc-mobile tocMobile_jdd7"><button type="button" class="clean-btn tocCollapsibleButton_uot6">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>问题总结</h1></header><h2 class="anchor anchorWithStickyNavbar_gDIi" id="netty-基础相关问题">Netty 基础相关问题<a href="#netty-基础相关问题" class="hash-link" aria-label="Direct link to Netty 基础相关问题" title="Direct link to Netty 基础相关问题">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="讲讲-netty-的特点">讲讲 Netty 的特点？<a href="#讲讲-netty-的特点" class="hash-link" aria-label="Direct link to 讲讲 Netty 的特点？" title="Direct link to 讲讲 Netty 的特点？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="netty-的高性能体现在">Netty 的高性能体现在？<a href="#netty-的高性能体现在" class="hash-link" aria-label="Direct link to Netty 的高性能体现在？" title="Direct link to Netty 的高性能体现在？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="netty-的线程模型是什么">Netty 的线程模型是什么？<a href="#netty-的线程模型是什么" class="hash-link" aria-label="Direct link to Netty 的线程模型是什么？" title="Direct link to Netty 的线程模型是什么？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="什么是-reactor-模型">什么是 Reactor 模型？<a href="#什么是-reactor-模型" class="hash-link" aria-label="Direct link to 什么是 Reactor 模型？" title="Direct link to 什么是 Reactor 模型？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="说说-netty-中几个重要的对象是什么它们之间的关系是什么">说说 Netty 中几个重要的对象是什么，它们之间的关系是什么？<a href="#说说-netty-中几个重要的对象是什么它们之间的关系是什么" class="hash-link" aria-label="Direct link to 说说 Netty 中几个重要的对象是什么，它们之间的关系是什么？" title="Direct link to 说说 Netty 中几个重要的对象是什么，它们之间的关系是什么？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="eventloop-与-eventloopgroup-是什么关系">EventLoop 与 EventLoopGroup 是什么关系？<a href="#eventloop-与-eventloopgroup-是什么关系" class="hash-link" aria-label="Direct link to EventLoop 与 EventLoopGroup 是什么关系？" title="Direct link to EventLoop 与 EventLoopGroup 是什么关系？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="channel-与-socket-是什么关系channel-与-eventloop-是什么关系channel-与-channelpipeline-是什么关系">Channel 与 Socket 是什么关系，Channel 与 EventLoop 是什么关系，Channel 与 ChannelPipeline 是什么关系？<a href="#channel-与-socket-是什么关系channel-与-eventloop-是什么关系channel-与-channelpipeline-是什么关系" class="hash-link" aria-label="Direct link to Channel 与 Socket 是什么关系，Channel 与 EventLoop 是什么关系，Channel 与 ChannelPipeline 是什么关系？" title="Direct link to Channel 与 Socket 是什么关系，Channel 与 EventLoop 是什么关系，Channel 与 ChannelPipeline 是什么关系？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="讲讲-netty-底层操作与-java-nio-操作对应关系">讲讲 Netty 底层操作与 Java NIO 操作对应关系？<a href="#讲讲-netty-底层操作与-java-nio-操作对应关系" class="hash-link" aria-label="Direct link to 讲讲 Netty 底层操作与 Java NIO 操作对应关系？" title="Direct link to 讲讲 Netty 底层操作与 Java NIO 操作对应关系？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="netty-的-channelhandler-为什么需要-sharable-注解">Netty 的 ChannelHandler 为什么需要 @Sharable 注解？<a href="#netty-的-channelhandler-为什么需要-sharable-注解" class="hash-link" aria-label="Direct link to Netty 的 ChannelHandler 为什么需要 @Sharable 注解？" title="Direct link to Netty 的 ChannelHandler 为什么需要 @Sharable 注解？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="spring-postconstruct-是什么">Spring @PostConstruct 是什么？<a href="#spring-postconstruct-是什么" class="hash-link" aria-label="Direct link to Spring @PostConstruct 是什么？" title="Direct link to Spring @PostConstruct 是什么？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="计算机网络中mtumss是什么">计算机网络中MTU、MSS是什么？<a href="#计算机网络中mtumss是什么" class="hash-link" aria-label="Direct link to 计算机网络中MTU、MSS是什么？" title="Direct link to 计算机网络中MTU、MSS是什么？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="断线重连策略指数退避算法">断线重连策略（指数退避算法）<a href="#断线重连策略指数退避算法" class="hash-link" aria-label="Direct link to 断线重连策略（指数退避算法）" title="Direct link to 断线重连策略（指数退避算法）">​</a></h3>
<p>指数退避算法(Exponential Backoff)是处理<strong>断线重连</strong>的经典策略，它通过<strong>逐步增加重连间隔时间</strong>来避免网络<strong>恢复初期</strong>的<strong>大量重试请求</strong>导致服务器过载。</p>
<p>基本思想：</p>
<ul>
<li>首次重连延迟：较短时间（如1秒）</li>
<li>每次重连失败后：延迟时间按指数增长</li>
<li>达到最大延迟时间后：保持最大延迟不变</li>
<li>重连成功后：重置延迟时间</li>
</ul>
<p>优势：</p>
<ul>
<li>避免网络刚恢复时的&quot;惊群效应&quot;</li>
<li>减少不必要的重试请求</li>
<li>平衡及时性和系统负载</li>
</ul>
<p><strong>连接状态处理：</strong></p>
<ul>
<li>连接成功时重置计数器</li>
<li>连接失败时递增计数器并计算下次重连时间</li>
<li>达到最大重试次数后优雅关闭</li>
</ul>
<div class="language-java codeBlockContainer_meTV theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_EtmH"><pre tabindex="0" class="prism-code language-java codeBlock_SgF9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_TAte"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ReconnectClient</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> host</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//最大重试次数 超过以后优雅关闭workerGroup</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> maxRetries</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//最大延迟时间 如果超过了则取maxDelaySec为最大延迟时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> maxDelaySec</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">Bootstrap</span><span class="token plain"> bootstrap</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">EventLoopGroup</span><span class="token plain"> workerGroup</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//当前重试次数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token class-name">AtomicInteger</span><span class="token plain"> retryCount </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">AtomicInteger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">ReconnectClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token plain"> host</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> maxRetries</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> maxDelaySec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">host </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> host</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">port </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">maxRetries </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> maxRetries</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">maxDelaySec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> maxDelaySec</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">initBootstrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">initBootstrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        workerGroup </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">NioEventLoopGroup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bootstrap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Bootstrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bootstrap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">group</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">workerGroup</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">channel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">NioSocketChannel</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">handler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ChannelInitializer</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">SocketChannel</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">initChannel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">SocketChannel</span><span class="token plain"> ch</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token class-name">ChannelPipeline</span><span class="token plain"> pipeline </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">pipeline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        pipeline</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addLast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IdleStateHandler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        pipeline</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addLast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ReconnectHandler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ReconnectClient</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">ChannelFuture</span><span class="token plain"> future </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bootstrap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">host</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        future</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ChannelFutureListener</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> f </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">isSuccess</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;连接失败，准备重连...&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">scheduleReconnect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;连接成功!&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                retryCount</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 重置重试计数器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">scheduleReconnect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">retryCount</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> maxRetries</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;达到最大重试次数，停止重连&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            workerGroup</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">shutdownGracefully</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 计算退避时间 (2^n秒，最大不超过maxDelaySec)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> retries </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> retryCount</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getAndIncrement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//指数计算，如果超过了最大延迟时间，则取最大延迟时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> delay </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1L</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> retries</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxDelaySec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;第%d次重连将在%d秒后执行...%n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> retries </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> delay</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 调度重连任务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//使用EventLoop的定时任务功能，避免创建额外线程</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        workerGroup</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">schedule</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;执行重连...&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> delay</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">TimeUnit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">SECONDS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">String</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> args</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">ReconnectClient</span><span class="token plain"> client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ReconnectClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;127.0.0.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">60</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//可选，根据业务选择</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ReconnectHandler</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">ChannelInboundHandlerAdapter</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token class-name">ReconnectClient</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token class-name">ReconnectHandler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ReconnectClient</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//服务端断开连接的时候尝试重连接，但是需要结合业务，有的场景不可以在此处处理重新连接！！！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">channelInactive</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ChannelHandlerContext</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;连接断开，准备重连...&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">channel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">eventLoop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">schedule</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">TimeUnit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">SECONDS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 立即重连</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">exceptionCaught</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ChannelHandlerContext</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Throwable</span><span class="token plain"> cause</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cause</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">printStackTrace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_mDNQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FByp" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Jb1P"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_x7BQ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>高级优化方案：</strong></p>
<p>1、为避免多个客户端同步重连，可以在退避时间中加入随机因子</p>
<div class="language-java codeBlockContainer_meTV theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_EtmH"><pre tabindex="0" class="prism-code language-java codeBlock_SgF9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_TAte"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 在计算delay时加入随机抖动(±30%)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">long</span><span class="token plain"> jitter </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">long</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">delay </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">random</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">delay </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">min</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">delay </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> jitter</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> maxDelaySec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_mDNQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FByp" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Jb1P"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_x7BQ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>2、结合IdleStateHandler实现心跳机制，在发现连接空闲时主动重连</p>
<div class="language-java codeBlockContainer_meTV theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_EtmH"><pre tabindex="0" class="prism-code language-java codeBlock_SgF9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_TAte"><span class="token-line" style="color:#393A34"><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">userEventTriggered</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ChannelHandlerContext</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token plain"> evt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">evt </span><span class="token keyword" style="color:#00009f">instanceof</span><span class="token plain"> </span><span class="token class-name">IdleStateEvent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;检测到连接空闲，主动关闭并重连...&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">channel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">future </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_mDNQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FByp" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Jb1P"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_x7BQ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="流量整形trafficshapinghandler">流量整形（TrafficShapingHandler）<a href="#流量整形trafficshapinghandler" class="hash-link" aria-label="Direct link to 流量整形（TrafficShapingHandler）" title="Direct link to 流量整形（TrafficShapingHandler）">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="ssl和tls有什么区别">SSL和TLS有什么区别<a href="#ssl和tls有什么区别" class="hash-link" aria-label="Direct link to SSL和TLS有什么区别" title="Direct link to SSL和TLS有什么区别">​</a></h3>
<p><strong>注意：SSL 3.0存在重大安全漏洞，已经弃用！</strong></p>
<p>TLS是从SSL3.0基础上改进而来的，是SSL的<strong>继承者</strong>，安全性更高，支持更多的加密算法，同时TLS1.3大幅度减少了握手次数提升了性能，目前TLS的行业标准是<strong>TLS 1.2</strong>和<strong>TLS1.3</strong>版本。</p>
<p>单向认证案例：</p>
<p>1、客户端</p>
<div class="language-java codeBlockContainer_meTV theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_EtmH"><pre tabindex="0" class="prism-code language-java codeBlock_SgF9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_TAte"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 加载服务端的信任证书</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">File</span><span class="token plain"> trustCertFile </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">File</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;server_cert.pem&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 配置支持 TLS 1.3 的 SSL 上下文</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">SslContext</span><span class="token plain"> sslContext </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">SslContextBuilder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">trustManager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">trustCertFile</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 信任服务端证书</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">protocols</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;TLSv1.3&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 指定使用 TLS 1.3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 添加 SSL 处理器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pipeline</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addLast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sslContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">newHandler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">alloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_mDNQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FByp" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Jb1P"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_x7BQ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>2、服务端</p>
<div class="language-java codeBlockContainer_meTV theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_EtmH"><pre tabindex="0" class="prism-code language-java codeBlock_SgF9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_TAte"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 加载服务端证书和私钥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">File</span><span class="token plain"> certFile </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">File</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;server_cert.pem&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">File</span><span class="token plain"> keyFile </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">File</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;server_key.pem&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 配置支持 TLS 1.3 的 SSL 上下文</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">SslContext</span><span class="token plain"> sslContext </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">SslContextBuilder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forServer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">certFile</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> keyFile</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">protocols</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;TLSv1.3&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 指定使用 TLS 1.3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 添加 SSL 处理器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pipeline</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addLast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sslContext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">newHandler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">alloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_mDNQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FByp" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Jb1P"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_x7BQ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果需要实现双向认证，需要将客户端认证代码改为：</p>
<div class="language-java codeBlockContainer_meTV theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_EtmH"><pre tabindex="0" class="prism-code language-java codeBlock_SgF9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_TAte"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 加载客户端证书和私钥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">File</span><span class="token plain"> clientCert </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">File</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;client_cert.pem&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">File</span><span class="token plain"> clientKey </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">File</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;client_key.pem&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 加载服务端证书（用于验证服务端）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">File</span><span class="token plain"> serverCert </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">File</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;server_cert.pem&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 配置 SSL 上下文</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">SslContext</span><span class="token plain"> sslContext </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">SslContextBuilder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">forClient</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">keyManager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">clientCert</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> clientKey</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 客户端证书和私钥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">trustManager</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serverCert</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 信任服务端证书</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">protocols</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;TLSv1.3&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 指定使用 TLS 1.3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">build</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_mDNQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FByp" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Jb1P"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_x7BQ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>证书密钥生成工具可采用：openssl</p>
<h2 class="anchor anchorWithStickyNavbar_gDIi" id="java-nio-相关问题">Java NIO 相关问题<a href="#java-nio-相关问题" class="hash-link" aria-label="Direct link to Java NIO 相关问题" title="Direct link to Java NIO 相关问题">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="bionio-和-aio-的区别">BIO、NIO 和 AIO 的区别？<a href="#bionio-和-aio-的区别" class="hash-link" aria-label="Direct link to BIO、NIO 和 AIO 的区别？" title="Direct link to BIO、NIO 和 AIO 的区别？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="nio-的组成是什么">NIO 的组成是什么？<a href="#nio-的组成是什么" class="hash-link" aria-label="Direct link to NIO 的组成是什么？" title="Direct link to NIO 的组成是什么？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="如何使用-java-nio-搭建简单的客户端与服务端实现网络通讯">如何使用 Java NIO 搭建简单的客户端与服务端实现网络通讯？<a href="#如何使用-java-nio-搭建简单的客户端与服务端实现网络通讯" class="hash-link" aria-label="Direct link to 如何使用 Java NIO 搭建简单的客户端与服务端实现网络通讯？" title="Direct link to 如何使用 Java NIO 搭建简单的客户端与服务端实现网络通讯？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="如何解决-jdk-nio-的空轮询-bug">如何解决 JDK NIO 的空轮询 Bug？<a href="#如何解决-jdk-nio-的空轮询-bug" class="hash-link" aria-label="Direct link to 如何解决 JDK NIO 的空轮询 Bug？" title="Direct link to 如何解决 JDK NIO 的空轮询 Bug？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="selectpollepoll-的区别">Select、Poll、Epoll 的区别？<a href="#selectpollepoll-的区别" class="hash-link" aria-label="Direct link to Select、Poll、Epoll 的区别？" title="Direct link to Select、Poll、Epoll 的区别？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="如何实现断线重连">如何实现断线重连<a href="#如何实现断线重连" class="hash-link" aria-label="Direct link to 如何实现断线重连" title="Direct link to 如何实现断线重连">​</a></h3>
<p>1、方法一：监听ChannelHandler#<strong>channelInactive</strong>方法，在断开连接的时候会调用此方法，可以在该方法中通过<code>固定时间间隔</code>、
<code>指数退避策略</code>、<code>无限重试</code>等逻辑实现重连服务器</p>
<p>2、方法二：在bootstrap中添加监听器实现重连，如：</p>
<div class="language-java codeBlockContainer_meTV theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_EtmH"><pre tabindex="0" class="prism-code language-java codeBlock_SgF9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_TAte"><span class="token-line" style="color:#393A34"><span class="token class-name">Bootstrap</span><span class="token plain"> bootstrap </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Bootstrap</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bootstrap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">group</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">NioEventLoopGroup</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">channel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">NioSocketChannel</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">class</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">handler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">ChannelInitializer</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">SocketChannel</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> initChannel </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">SocketChannel</span><span class="token plain"> ch</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">ChannelFuture</span><span class="token plain"> future </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bootstrap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;localhost&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8080</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">future</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">addListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ChannelFutureListener</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> f </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">isSuccess</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;连接失败，正在重试。..&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        f</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">channel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">eventLoop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">schedule</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">bootstrap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">connect</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;localhost&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">8080</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">SECONDS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_mDNQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FByp" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Jb1P"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_x7BQ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>3、方法三：组合心跳机制，在HeartbeatHandler中实现重连服务器。</p>
<div class="language-java codeBlockContainer_meTV theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_EtmH"><pre tabindex="0" class="prism-code language-java codeBlock_SgF9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_TAte"><span class="token-line" style="color:#393A34"><span class="token plain">pipeline</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">addLast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">IdleStateHandler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token class-name">TimeUnit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">SECONDS</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 5 秒读写空闲检测</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipeline</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">addLast</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">HeartbeatHandler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_mDNQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FByp" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Jb1P"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_x7BQ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="netty是如何实现心跳机制的原理是什么">Netty是如何实现心跳机制的？原理是什么？<a href="#netty是如何实现心跳机制的原理是什么" class="hash-link" aria-label="Direct link to Netty是如何实现心跳机制的？原理是什么？" title="Direct link to Netty是如何实现心跳机制的？原理是什么？">​</a></h3>
<p>采用IdleStateHandler处理器实现，该处理器内置了3个空闲超时定时任务线程分别处理3种状态，分别是<code>读空闲</code>、<code>写空闲</code>、<code>读写空闲</code>
，当检测到超时的时候就回触发相应的事件，并将事件传递到下一个handler，用户可以在
自定义的handler中通过重写#userEventTriggered方法监听事件进行业务处理。</p>
<div class="language-java codeBlockContainer_meTV theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_EtmH"><pre tabindex="0" class="prism-code language-java codeBlock_SgF9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_TAte"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token class-name">IdleState</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * 一段时间没有收到任何数据。</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">READER_IDLE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * 一段时间没有发送数据。</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">WRITER_IDLE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     * 一段时间没有收到或发送任何数据。</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">     */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token constant" style="color:#36acaa">ALL_IDLE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_mDNQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FByp" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Jb1P"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_x7BQ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-java codeBlockContainer_meTV theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_EtmH"><pre tabindex="0" class="prism-code language-java codeBlock_SgF9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_TAte"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">userEventTriggered</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ChannelHandlerContext</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token plain"> evt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">evt </span><span class="token keyword" style="color:#00009f">instanceof</span><span class="token plain"> </span><span class="token class-name">IdleStateEvent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">IdleStateEvent</span><span class="token plain"> event </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">IdeStateEvent</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> evt</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">state</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token class-name">IdleState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">READER_IDLE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//如读超时关闭连接</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//或写超时发送ping心跳信息ctx.write().writeAndFlush(&quot;PING\n&quot;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_mDNQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FByp" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Jb1P"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_x7BQ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="nioeventloopgroup-默认的构造函数会起多少线程">NioEventLoopGroup 默认的构造函数会起多少线程？<a href="#nioeventloopgroup-默认的构造函数会起多少线程" class="hash-link" aria-label="Direct link to NioEventLoopGroup 默认的构造函数会起多少线程？" title="Direct link to NioEventLoopGroup 默认的构造函数会起多少线程？">​</a></h3>
<p>如果用户没有指定线程数，默认会创建<strong>2*cpu核心数</strong>，例如4核cpu就会默认创建8个线程，源码如下：</p>
<div class="language-java codeBlockContainer_meTV theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_EtmH"><pre tabindex="0" class="prism-code language-java codeBlock_SgF9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_TAte codeBlockLinesWithNumbering_VfiG"><span class="token-line codeLine_Yiip" style="color:#393A34"><span class="codeLineNumber_e74U"></span><span class="codeLineContent_xcwl"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">abstract</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">MultithreadEventLoopGroup</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">MultithreadEventExecutorGroup</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">implements</span><span class="token plain"> </span><span class="token class-name">EventLoopGroup</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_Yiip" style="color:#393A34"><span class="codeLineNumber_e74U"></span><span class="codeLineContent_xcwl"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">private</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">final</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">DEFAULT_EVENT_LOOP_THREADS</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_Yiip" style="color:#393A34"><span class="codeLineNumber_e74U"></span><span class="codeLineContent_xcwl"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_Yiip" style="color:#393A34"><span class="codeLineNumber_e74U"></span><span class="codeLineContent_xcwl"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_Yiip" style="color:#393A34"><span class="codeLineNumber_e74U"></span><span class="codeLineContent_xcwl"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//采用max是为了健壮性考虑，避免极端场景如虚拟环境、容器限制等场景出现0，实际不会有0核的cpu</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_Yiip" style="color:#393A34"><span class="codeLineNumber_e74U"></span><span class="codeLineContent_xcwl"><span class="token plain">        </span><span class="token constant" style="color:#36acaa">DEFAULT_EVENT_LOOP_THREADS</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Math</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">SystemPropertyUtil</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">getInt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_Yiip" style="color:#393A34"><span class="codeLineNumber_e74U"></span><span class="codeLineContent_xcwl"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;io.netty.eventLoopThreads&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">NettyRuntime</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">availableProcessors</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_Yiip" style="color:#393A34"><span class="codeLineNumber_e74U"></span><span class="codeLineContent_xcwl"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_Yiip" style="color:#393A34"><span class="codeLineNumber_e74U"></span><span class="codeLineContent_xcwl"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span><br></span></code></pre><div class="buttonGroup_mDNQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FByp" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Jb1P"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_x7BQ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_gDIi" id="粘包与半包相关问题">粘包与半包相关问题<a href="#粘包与半包相关问题" class="hash-link" aria-label="Direct link to 粘包与半包相关问题" title="Direct link to 粘包与半包相关问题">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="什么是粘包与半包问题">什么是粘包与半包问题？<a href="#什么是粘包与半包问题" class="hash-link" aria-label="Direct link to 什么是粘包与半包问题？" title="Direct link to 什么是粘包与半包问题？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="粘包与半包为何会出现">粘包与半包为何会出现？<a href="#粘包与半包为何会出现" class="hash-link" aria-label="Direct link to 粘包与半包为何会出现？" title="Direct link to 粘包与半包为何会出现？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="netty-框架本身存在粘包半包问题">Netty 框架本身存在粘包半包问题？<a href="#netty-框架本身存在粘包半包问题" class="hash-link" aria-label="Direct link to Netty 框架本身存在粘包半包问题？" title="Direct link to Netty 框架本身存在粘包半包问题？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="什么时候需要考虑粘包与半包问题">什么时候需要考虑粘包与半包问题？<a href="#什么时候需要考虑粘包与半包问题" class="hash-link" aria-label="Direct link to 什么时候需要考虑粘包与半包问题？" title="Direct link to 什么时候需要考虑粘包与半包问题？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="如何避免粘包与半包问题">如何避免粘包与半包问题？<a href="#如何避免粘包与半包问题" class="hash-link" aria-label="Direct link to 如何避免粘包与半包问题？" title="Direct link to 如何避免粘包与半包问题？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="netty-如何解决拆包和粘包问题">Netty 如何解决拆包和粘包问题？<a href="#netty-如何解决拆包和粘包问题" class="hash-link" aria-label="Direct link to Netty 如何解决拆包和粘包问题？" title="Direct link to Netty 如何解决拆包和粘包问题？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="如何使用包定长-fixedlengthframedecoder-解决粘包与半包问题原理是什么">如何使用包定长 FixedLengthFrameDecoder 解决粘包与半包问题？原理是什么？<a href="#如何使用包定长-fixedlengthframedecoder-解决粘包与半包问题原理是什么" class="hash-link" aria-label="Direct link to 如何使用包定长 FixedLengthFrameDecoder 解决粘包与半包问题？原理是什么？" title="Direct link to 如何使用包定长 FixedLengthFrameDecoder 解决粘包与半包问题？原理是什么？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="如何使用包分隔符-delimiterbasedframedecoder-解决粘包与半包问题原理是什么">如何使用包分隔符 DelimiterBasedFrameDecoder 解决粘包与半包问题？原理是什么？<a href="#如何使用包分隔符-delimiterbasedframedecoder-解决粘包与半包问题原理是什么" class="hash-link" aria-label="Direct link to 如何使用包分隔符 DelimiterBasedFrameDecoder 解决粘包与半包问题？原理是什么？" title="Direct link to 如何使用包分隔符 DelimiterBasedFrameDecoder 解决粘包与半包问题？原理是什么？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="使用-netty-作为网络通讯时候是如何避免粘包与半包问题">使用 Netty 作为网络通讯时候是如何避免粘包与半包问题？<a href="#使用-netty-作为网络通讯时候是如何避免粘包与半包问题" class="hash-link" aria-label="Direct link to 使用 Netty 作为网络通讯时候是如何避免粘包与半包问题？" title="Direct link to 使用 Netty 作为网络通讯时候是如何避免粘包与半包问题？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="如何自定义任务">如何自定义任务<a href="#如何自定义任务" class="hash-link" aria-label="Direct link to 如何自定义任务" title="Direct link to 如何自定义任务">​</a></h3>
<p>特别注意：在handler上下文中添加的自定义任务是在<strong>同一个线程</strong>中执行，意味着对于多个任务将会<strong>串行执行</strong>！</p>
<div class="language-java codeBlockContainer_meTV theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_EtmH"><pre tabindex="0" class="prism-code language-java codeBlock_SgF9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_TAte"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">channelRead</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ChannelHandlerContext</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">Object</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// (2)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">channel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">eventLoop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Runnable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">Thread</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token comment" style="color:#999988;font-style:italic">//1秒后执行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;task 1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">channel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">eventLoop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">execute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Runnable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">Thread</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token class-name">System</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">println</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;task 2&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//30秒后执行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_mDNQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FByp" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Jb1P"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_x7BQ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_gDIi" id="netty-零拷贝相关问题">Netty 零拷贝相关问题<a href="#netty-零拷贝相关问题" class="hash-link" aria-label="Direct link to Netty 零拷贝相关问题" title="Direct link to Netty 零拷贝相关问题">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="说说对于-netty-的零拷贝理解">说说对于 Netty 的零拷贝理解？<a href="#说说对于-netty-的零拷贝理解" class="hash-link" aria-label="Direct link to 说说对于 Netty 的零拷贝理解？" title="Direct link to 说说对于 Netty 的零拷贝理解？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="netty-零拷贝体现在哪里">Netty 零拷贝体现在哪里？<a href="#netty-零拷贝体现在哪里" class="hash-link" aria-label="Direct link to Netty 零拷贝体现在哪里？" title="Direct link to Netty 零拷贝体现在哪里？">​</a></h3>
<h2 class="anchor anchorWithStickyNavbar_gDIi" id="websocket-协议开发相关问题">WebSocket 协议开发相关问题<a href="#websocket-协议开发相关问题" class="hash-link" aria-label="Direct link to WebSocket 协议开发相关问题" title="Direct link to WebSocket 协议开发相关问题">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="讲讲如何实现-websocket-长连接">讲讲如何实现 WebSocket 长连接？<a href="#讲讲如何实现-websocket-长连接" class="hash-link" aria-label="Direct link to 讲讲如何实现 WebSocket 长连接？" title="Direct link to 讲讲如何实现 WebSocket 长连接？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="讲讲-websocket-帧结构的理解">讲讲 WebSocket 帧结构的理解？<a href="#讲讲-websocket-帧结构的理解" class="hash-link" aria-label="Direct link to 讲讲 WebSocket 帧结构的理解？" title="Direct link to 讲讲 WebSocket 帧结构的理解？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="浏览器服务器对-websocket-的支持情况">浏览器、服务器对 WebSocket 的支持情况？<a href="#浏览器服务器对-websocket-的支持情况" class="hash-link" aria-label="Direct link to 浏览器、服务器对 WebSocket 的支持情况？" title="Direct link to 浏览器、服务器对 WebSocket 的支持情况？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="如何使用-websocket-接收和发送广播信息">如何使用 WebSocket 接收和发送广播信息？<a href="#如何使用-websocket-接收和发送广播信息" class="hash-link" aria-label="Direct link to 如何使用 WebSocket 接收和发送广播信息？" title="Direct link to 如何使用 WebSocket 接收和发送广播信息？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="如何使用-websocket-接收和发送二进制信息">如何使用 WebSocket 接收和发送二进制信息？<a href="#如何使用-websocket-接收和发送二进制信息" class="hash-link" aria-label="Direct link to 如何使用 WebSocket 接收和发送二进制信息？" title="Direct link to 如何使用 WebSocket 接收和发送二进制信息？">​</a></h3>
<h2 class="anchor anchorWithStickyNavbar_gDIi" id="netty-源码分析相关问题">Netty 源码分析相关问题<a href="#netty-源码分析相关问题" class="hash-link" aria-label="Direct link to Netty 源码分析相关问题" title="Direct link to Netty 源码分析相关问题">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="服务端如何进行初始化">服务端如何进行初始化？<a href="#服务端如何进行初始化" class="hash-link" aria-label="Direct link to 服务端如何进行初始化？" title="Direct link to 服务端如何进行初始化？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="何时接受客户端请求">何时接受客户端请求？<a href="#何时接受客户端请求" class="hash-link" aria-label="Direct link to 何时接受客户端请求？" title="Direct link to 何时接受客户端请求？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="何时注册接受-socket-并注册到对应的-eventloop-管理的-selector">何时注册接受 Socket 并注册到对应的 EventLoop 管理的 Selector？<a href="#何时注册接受-socket-并注册到对应的-eventloop-管理的-selector" class="hash-link" aria-label="Direct link to 何时注册接受 Socket 并注册到对应的 EventLoop 管理的 Selector？" title="Direct link to 何时注册接受 Socket 并注册到对应的 EventLoop 管理的 Selector？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="客户端如何进行初始化">客户端如何进行初始化？<a href="#客户端如何进行初始化" class="hash-link" aria-label="Direct link to 客户端如何进行初始化？" title="Direct link to 客户端如何进行初始化？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="何时创建的-defaultchannelpipeline">何时创建的 DefaultChannelPipeline？<a href="#何时创建的-defaultchannelpipeline" class="hash-link" aria-label="Direct link to 何时创建的 DefaultChannelPipeline？" title="Direct link to 何时创建的 DefaultChannelPipeline？">​</a></h3>
<h2 class="anchor anchorWithStickyNavbar_gDIi" id="tcp-连接与序列化协议相关问题">TCP 连接与序列化协议相关问题<a href="#tcp-连接与序列化协议相关问题" class="hash-link" aria-label="Direct link to TCP 连接与序列化协议相关问题" title="Direct link to TCP 连接与序列化协议相关问题">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="tcp-的长连接和短连接">TCP 的长连接和短连接？<a href="#tcp-的长连接和短连接" class="hash-link" aria-label="Direct link to TCP 的长连接和短连接？" title="Direct link to TCP 的长连接和短连接？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="有哪些序列化协议">有哪些序列化协议？<a href="#有哪些序列化协议" class="hash-link" aria-label="Direct link to 有哪些序列化协议？" title="Direct link to 有哪些序列化协议？">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="channelpipeline的inboundoutbound事件传播机制">ChannelPipeline的inbound/outbound事件传播机制<a href="#channelpipeline的inboundoutbound事件传播机制" class="hash-link" aria-label="Direct link to ChannelPipeline的inbound/outbound事件传播机制" title="Direct link to ChannelPipeline的inbound/outbound事件传播机制">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="channelhandlercontext的传播逻辑">ChannelHandlerContext的传播逻辑<a href="#channelhandlercontext的传播逻辑" class="hash-link" aria-label="Direct link to ChannelHandlerContext的传播逻辑" title="Direct link to ChannelHandlerContext的传播逻辑">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="nioeventloop事件循环流程">NioEventLoop事件循环流程<a href="#nioeventloop事件循环流程" class="hash-link" aria-label="Direct link to NioEventLoop事件循环流程" title="Direct link to NioEventLoop事件循环流程">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="内存泄漏检测原理resourceleakdetector">内存泄漏检测原理（ResourceLeakDetector）<a href="#内存泄漏检测原理resourceleakdetector" class="hash-link" aria-label="Direct link to 内存泄漏检测原理（ResourceLeakDetector）" title="Direct link to 内存泄漏检测原理（ResourceLeakDetector）">​</a></h3>
<h2 class="anchor anchorWithStickyNavbar_gDIi" id="应用项目设计相关">应用项目设计相关<a href="#应用项目设计相关" class="hash-link" aria-label="Direct link to 应用项目设计相关" title="Direct link to 应用项目设计相关">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="如何设计一个java对象池减少gc和内存分配消耗">如何设计一个Java对象池，减少GC和内存分配消耗<a href="#如何设计一个java对象池减少gc和内存分配消耗" class="hash-link" aria-label="Direct link to 如何设计一个Java对象池，减少GC和内存分配消耗" title="Direct link to 如何设计一个Java对象池，减少GC和内存分配消耗">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="如何设计一个内存池或者内存分配器">如何设计一个内存池，或者内存分配器<a href="#如何设计一个内存池或者内存分配器" class="hash-link" aria-label="Direct link to 如何设计一个内存池，或者内存分配器" title="Direct link to 如何设计一个内存池，或者内存分配器">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="如何用netty处理http请求实现增删改查">如何用netty处理http请求实现增删改查<a href="#如何用netty处理http请求实现增删改查" class="hash-link" aria-label="Direct link to 如何用netty处理http请求实现增删改查" title="Direct link to 如何用netty处理http请求实现增删改查">​</a></h3>
<p>核心处理器：</p>
<ul>
<li>HttpServerCodec 编解码</li>
<li>HttpObjectAggregator 消息聚合</li>
<li>ChunkedWriteHandler 大文件支持 数据切割</li>
<li>HttpRequestHandler（自定义用于处理自己业务的处理器）</li>
</ul>
<div class="language-java codeBlockContainer_meTV theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_EtmH"><pre tabindex="0" class="prism-code language-java codeBlock_SgF9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_TAte"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">HttpRequestHandler</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">SimpleChannelInboundHandler</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">FullHttpRequest</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">channelRead0</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ChannelHandlerContext</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">FullHttpRequest</span><span class="token plain"> request</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//FullHttpResponse用于构建响应 例如返回数据 响应头等</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_mDNQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FByp" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Jb1P"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_x7BQ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_gDIi" id="性能优化相关">性能优化相关<a href="#性能优化相关" class="hash-link" aria-label="Direct link to 性能优化相关" title="Direct link to 性能优化相关">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="内存优化-对象池化recycler">内存优化-对象池化（Recycler）<a href="#内存优化-对象池化recycler" class="hash-link" aria-label="Direct link to 内存优化-对象池化（Recycler）" title="Direct link to 内存优化-对象池化（Recycler）">​</a></h3>
<p>源码应用：ByteBuf</p>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="内存优化-directbuffer-vs-heapbuffer">内存优化-DirectBuffer vs HeapBuffer<a href="#内存优化-directbuffer-vs-heapbuffer" class="hash-link" aria-label="Direct link to 内存优化-DirectBuffer vs HeapBuffer" title="Direct link to 内存优化-DirectBuffer vs HeapBuffer">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="零拷贝-fileregion文件传输">零拷贝-FileRegion文件传输<a href="#零拷贝-fileregion文件传输" class="hash-link" aria-label="Direct link to 零拷贝-FileRegion文件传输" title="Direct link to 零拷贝-FileRegion文件传输">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="零拷贝-compositebytebuf合并缓冲">零拷贝-CompositeByteBuf合并缓冲<a href="#零拷贝-compositebytebuf合并缓冲" class="hash-link" aria-label="Direct link to 零拷贝-CompositeByteBuf合并缓冲" title="Direct link to 零拷贝-CompositeByteBuf合并缓冲">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="锁优化无锁化设计">锁优化（无锁化设计）<a href="#锁优化无锁化设计" class="hash-link" aria-label="Direct link to 锁优化（无锁化设计）" title="Direct link to 锁优化（无锁化设计）">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="promise与future异步编程">Promise与Future异步编程<a href="#promise与future异步编程" class="hash-link" aria-label="Direct link to Promise与Future异步编程" title="Direct link to Promise与Future异步编程">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="避免channelhandler阻塞业务线程池">避免ChannelHandler阻塞（业务线程池）<a href="#避免channelhandler阻塞业务线程池" class="hash-link" aria-label="Direct link to 避免ChannelHandler阻塞（业务线程池）" title="Direct link to 避免ChannelHandler阻塞（业务线程池）">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_gDIi" id="如何自定义编解码器详细说一下">如何自定义编解码器，详细说一下<a href="#如何自定义编解码器详细说一下" class="hash-link" aria-label="Direct link to 如何自定义编解码器，详细说一下" title="Direct link to 如何自定义编解码器，详细说一下">​</a></h3>
<p><img decoding="async" loading="lazy" alt="img_1.png" src="/xilio-doc/en/assets/images/img_1-344c3b2e576bbcb3fbda5e265cf6733b.png" width="1816" height="232" class="img_WIaf">
TCP是以流的方式进行字节传输的，所以无法知道数据的边界，也就意味着无法区分出一串数据，比如一段二进制由于没有边界，客户端收到以后随意截取就会导致数据错乱，不是期望收到的数据。</p>
<p><strong>下面一段代码是一个基本的解码器的案例：</strong></p>
<div class="language-java codeBlockContainer_meTV theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_EtmH"><pre tabindex="0" class="prism-code language-java codeBlock_SgF9 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_TAte"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">public</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">CustomDecoder</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">extends</span><span class="token plain"> </span><span class="token class-name">ByteToMessageDecoder</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token annotation punctuation" style="color:#393A34">@Override</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">protected</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">decode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">ChannelHandlerContext</span><span class="token plain"> ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">ByteBuf</span><span class="token plain"> in</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">List</span><span class="token generics punctuation" style="color:#393A34">&lt;</span><span class="token generics class-name">Object</span><span class="token generics punctuation" style="color:#393A34">&gt;</span><span class="token plain"> out</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">throws</span><span class="token plain"> </span><span class="token class-name">Exception</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">in</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">readableBytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 检查是否有足够的字节读取长度字段 【1】</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> length </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> in</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">readInt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 读取4字节的长度字段 【2】</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">in</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">readableBytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//【3】</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            in</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">resetReaderIndex</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 数据不足，重置读取位置 【4】</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token class-name">ByteBuf</span><span class="token plain"> frame </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> in</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">readBytes</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 读取消息体【5】</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        out</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">frame</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 输出到下游 【6】</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_mDNQ"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FByp" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_Jb1P"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_x7BQ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>代码详解：</p>
<p>【1】<code>in.readableBytes() &lt; 4</code></p>
<p>这段代码的效果是从TCP流中读取4个字节（想象从TCP流的最开始位置），这4个字节是用来记录后面Body数据的长度的，这样就可以确定后面数据的边界，确定后面的数据边界以后，通过偏移量就可以得到下一个Head，通过Head又可以得到后面Body的长度，
以此类推，这样一来字节流就形成了边界，就可以组装成正确的数据了；那为什么是4而不是其他的呢？其实也可以是其他的（比如2、8字节等），因为4字节可以记录的长度在java中是32位，已经可以得到足够大的整数了，几乎可以满足所有的场景，这也是一个折中的选择
如果用2字节表示的长度又太小，后面的Body内容实际可能很长，如果用8字节，那可能没必要，因为后面的Body大多数场景实际的数据没有那么长，如果用8的话就会造成浪费，完全没必要，所以这就是为什么要用4的原因。</p>
<p>【2】<code>in.readInt()</code></p>
<p>这段代码的效果是读取4字节（我们规定的是4字节表示头），可以读取到一个整数表示后面Body的长度，连续读取该长度就可以得到一个正常的数据。</p>
<p>【3】<code>in.readableBytes() &lt; length</code></p>
<p>通过Head头我们知道后面Body应该读取多少长度的数据，但是由于TCP基于流的，可能会将一个很长的消息进行拆分传输，导致没有收到完整的的数据，也就是常常说的半包问题，
因此需要做一个判断，等下次数据满足Head要读取的长度后再读取。</p>
<p>【4】<code>in.resetReaderIndex() </code>
将索引恢复到上次的位置，不然下次读取就会错乱，原因在于调用<code>in.readableBytes()</code>会导致索引先后移动，竟然这次都没有读取成功，肯定要恢复。</p>
<p>【5】<code>in.readBytes(length)</code></p>
<p>终于可以读取指定长度（来自Head）的字节数量了，得到的就是实际的Body内容，也就是发送者单次实际发送的数据。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/xilio-dev/xilio-doc/tree/main/docs/base/Netty/问题总结.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_NZGJ" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_CBNV"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/xilio-doc/en/docs/base/Netty/网络基础"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">网络基础</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/xilio-doc/en/docs/base/Netty/高级"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">高级</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_L7y9 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#netty-基础相关问题" class="table-of-contents__link toc-highlight">Netty 基础相关问题</a><ul><li><a href="#讲讲-netty-的特点" class="table-of-contents__link toc-highlight">讲讲 Netty 的特点？</a></li><li><a href="#netty-的高性能体现在" class="table-of-contents__link toc-highlight">Netty 的高性能体现在？</a></li><li><a href="#netty-的线程模型是什么" class="table-of-contents__link toc-highlight">Netty 的线程模型是什么？</a></li><li><a href="#什么是-reactor-模型" class="table-of-contents__link toc-highlight">什么是 Reactor 模型？</a></li><li><a href="#说说-netty-中几个重要的对象是什么它们之间的关系是什么" class="table-of-contents__link toc-highlight">说说 Netty 中几个重要的对象是什么，它们之间的关系是什么？</a></li><li><a href="#eventloop-与-eventloopgroup-是什么关系" class="table-of-contents__link toc-highlight">EventLoop 与 EventLoopGroup 是什么关系？</a></li><li><a href="#channel-与-socket-是什么关系channel-与-eventloop-是什么关系channel-与-channelpipeline-是什么关系" class="table-of-contents__link toc-highlight">Channel 与 Socket 是什么关系，Channel 与 EventLoop 是什么关系，Channel 与 ChannelPipeline 是什么关系？</a></li><li><a href="#讲讲-netty-底层操作与-java-nio-操作对应关系" class="table-of-contents__link toc-highlight">讲讲 Netty 底层操作与 Java NIO 操作对应关系？</a></li><li><a href="#netty-的-channelhandler-为什么需要-sharable-注解" class="table-of-contents__link toc-highlight">Netty 的 ChannelHandler 为什么需要 @Sharable 注解？</a></li><li><a href="#spring-postconstruct-是什么" class="table-of-contents__link toc-highlight">Spring @PostConstruct 是什么？</a></li><li><a href="#计算机网络中mtumss是什么" class="table-of-contents__link toc-highlight">计算机网络中MTU、MSS是什么？</a></li><li><a href="#断线重连策略指数退避算法" class="table-of-contents__link toc-highlight">断线重连策略（指数退避算法）</a></li><li><a href="#流量整形trafficshapinghandler" class="table-of-contents__link toc-highlight">流量整形（TrafficShapingHandler）</a></li><li><a href="#ssl和tls有什么区别" class="table-of-contents__link toc-highlight">SSL和TLS有什么区别</a></li></ul></li><li><a href="#java-nio-相关问题" class="table-of-contents__link toc-highlight">Java NIO 相关问题</a><ul><li><a href="#bionio-和-aio-的区别" class="table-of-contents__link toc-highlight">BIO、NIO 和 AIO 的区别？</a></li><li><a href="#nio-的组成是什么" class="table-of-contents__link toc-highlight">NIO 的组成是什么？</a></li><li><a href="#如何使用-java-nio-搭建简单的客户端与服务端实现网络通讯" class="table-of-contents__link toc-highlight">如何使用 Java NIO 搭建简单的客户端与服务端实现网络通讯？</a></li><li><a href="#如何解决-jdk-nio-的空轮询-bug" class="table-of-contents__link toc-highlight">如何解决 JDK NIO 的空轮询 Bug？</a></li><li><a href="#selectpollepoll-的区别" class="table-of-contents__link toc-highlight">Select、Poll、Epoll 的区别？</a></li><li><a href="#如何实现断线重连" class="table-of-contents__link toc-highlight">如何实现断线重连</a></li><li><a href="#netty是如何实现心跳机制的原理是什么" class="table-of-contents__link toc-highlight">Netty是如何实现心跳机制的？原理是什么？</a></li><li><a href="#nioeventloopgroup-默认的构造函数会起多少线程" class="table-of-contents__link toc-highlight">NioEventLoopGroup 默认的构造函数会起多少线程？</a></li></ul></li><li><a href="#粘包与半包相关问题" class="table-of-contents__link toc-highlight">粘包与半包相关问题</a><ul><li><a href="#什么是粘包与半包问题" class="table-of-contents__link toc-highlight">什么是粘包与半包问题？</a></li><li><a href="#粘包与半包为何会出现" class="table-of-contents__link toc-highlight">粘包与半包为何会出现？</a></li><li><a href="#netty-框架本身存在粘包半包问题" class="table-of-contents__link toc-highlight">Netty 框架本身存在粘包半包问题？</a></li><li><a href="#什么时候需要考虑粘包与半包问题" class="table-of-contents__link toc-highlight">什么时候需要考虑粘包与半包问题？</a></li><li><a href="#如何避免粘包与半包问题" class="table-of-contents__link toc-highlight">如何避免粘包与半包问题？</a></li><li><a href="#netty-如何解决拆包和粘包问题" class="table-of-contents__link toc-highlight">Netty 如何解决拆包和粘包问题？</a></li><li><a href="#如何使用包定长-fixedlengthframedecoder-解决粘包与半包问题原理是什么" class="table-of-contents__link toc-highlight">如何使用包定长 FixedLengthFrameDecoder 解决粘包与半包问题？原理是什么？</a></li><li><a href="#如何使用包分隔符-delimiterbasedframedecoder-解决粘包与半包问题原理是什么" class="table-of-contents__link toc-highlight">如何使用包分隔符 DelimiterBasedFrameDecoder 解决粘包与半包问题？原理是什么？</a></li><li><a href="#使用-netty-作为网络通讯时候是如何避免粘包与半包问题" class="table-of-contents__link toc-highlight">使用 Netty 作为网络通讯时候是如何避免粘包与半包问题？</a></li><li><a href="#如何自定义任务" class="table-of-contents__link toc-highlight">如何自定义任务</a></li></ul></li><li><a href="#netty-零拷贝相关问题" class="table-of-contents__link toc-highlight">Netty 零拷贝相关问题</a><ul><li><a href="#说说对于-netty-的零拷贝理解" class="table-of-contents__link toc-highlight">说说对于 Netty 的零拷贝理解？</a></li><li><a href="#netty-零拷贝体现在哪里" class="table-of-contents__link toc-highlight">Netty 零拷贝体现在哪里？</a></li></ul></li><li><a href="#websocket-协议开发相关问题" class="table-of-contents__link toc-highlight">WebSocket 协议开发相关问题</a><ul><li><a href="#讲讲如何实现-websocket-长连接" class="table-of-contents__link toc-highlight">讲讲如何实现 WebSocket 长连接？</a></li><li><a href="#讲讲-websocket-帧结构的理解" class="table-of-contents__link toc-highlight">讲讲 WebSocket 帧结构的理解？</a></li><li><a href="#浏览器服务器对-websocket-的支持情况" class="table-of-contents__link toc-highlight">浏览器、服务器对 WebSocket 的支持情况？</a></li><li><a href="#如何使用-websocket-接收和发送广播信息" class="table-of-contents__link toc-highlight">如何使用 WebSocket 接收和发送广播信息？</a></li><li><a href="#如何使用-websocket-接收和发送二进制信息" class="table-of-contents__link toc-highlight">如何使用 WebSocket 接收和发送二进制信息？</a></li></ul></li><li><a href="#netty-源码分析相关问题" class="table-of-contents__link toc-highlight">Netty 源码分析相关问题</a><ul><li><a href="#服务端如何进行初始化" class="table-of-contents__link toc-highlight">服务端如何进行初始化？</a></li><li><a href="#何时接受客户端请求" class="table-of-contents__link toc-highlight">何时接受客户端请求？</a></li><li><a href="#何时注册接受-socket-并注册到对应的-eventloop-管理的-selector" class="table-of-contents__link toc-highlight">何时注册接受 Socket 并注册到对应的 EventLoop 管理的 Selector？</a></li><li><a href="#客户端如何进行初始化" class="table-of-contents__link toc-highlight">客户端如何进行初始化？</a></li><li><a href="#何时创建的-defaultchannelpipeline" class="table-of-contents__link toc-highlight">何时创建的 DefaultChannelPipeline？</a></li></ul></li><li><a href="#tcp-连接与序列化协议相关问题" class="table-of-contents__link toc-highlight">TCP 连接与序列化协议相关问题</a><ul><li><a href="#tcp-的长连接和短连接" class="table-of-contents__link toc-highlight">TCP 的长连接和短连接？</a></li><li><a href="#有哪些序列化协议" class="table-of-contents__link toc-highlight">有哪些序列化协议？</a></li><li><a href="#channelpipeline的inboundoutbound事件传播机制" class="table-of-contents__link toc-highlight">ChannelPipeline的inbound/outbound事件传播机制</a></li><li><a href="#channelhandlercontext的传播逻辑" class="table-of-contents__link toc-highlight">ChannelHandlerContext的传播逻辑</a></li><li><a href="#nioeventloop事件循环流程" class="table-of-contents__link toc-highlight">NioEventLoop事件循环流程</a></li><li><a href="#内存泄漏检测原理resourceleakdetector" class="table-of-contents__link toc-highlight">内存泄漏检测原理（ResourceLeakDetector）</a></li></ul></li><li><a href="#应用项目设计相关" class="table-of-contents__link toc-highlight">应用项目设计相关</a><ul><li><a href="#如何设计一个java对象池减少gc和内存分配消耗" class="table-of-contents__link toc-highlight">如何设计一个Java对象池，减少GC和内存分配消耗</a></li><li><a href="#如何设计一个内存池或者内存分配器" class="table-of-contents__link toc-highlight">如何设计一个内存池，或者内存分配器</a></li><li><a href="#如何用netty处理http请求实现增删改查" class="table-of-contents__link toc-highlight">如何用netty处理http请求实现增删改查</a></li></ul></li><li><a href="#性能优化相关" class="table-of-contents__link toc-highlight">性能优化相关</a><ul><li><a href="#内存优化-对象池化recycler" class="table-of-contents__link toc-highlight">内存优化-对象池化（Recycler）</a></li><li><a href="#内存优化-directbuffer-vs-heapbuffer" class="table-of-contents__link toc-highlight">内存优化-DirectBuffer vs HeapBuffer</a></li><li><a href="#零拷贝-fileregion文件传输" class="table-of-contents__link toc-highlight">零拷贝-FileRegion文件传输</a></li><li><a href="#零拷贝-compositebytebuf合并缓冲" class="table-of-contents__link toc-highlight">零拷贝-CompositeByteBuf合并缓冲</a></li><li><a href="#锁优化无锁化设计" class="table-of-contents__link toc-highlight">锁优化（无锁化设计）</a></li><li><a href="#promise与future异步编程" class="table-of-contents__link toc-highlight">Promise与Future异步编程</a></li><li><a href="#避免channelhandler阻塞业务线程池" class="table-of-contents__link toc-highlight">避免ChannelHandler阻塞（业务线程池）</a></li><li><a href="#如何自定义编解码器详细说一下" class="table-of-contents__link toc-highlight">如何自定义编解码器，详细说一下</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 xilio</div></div></div></footer></div>
</body>
</html>